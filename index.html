<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Depo Savaşları: EO'nun Dükkanı</title>
    <style>
        :root {
            --bg-color: #121212;
            --text-color: #e0e0e0;
            --accent-color: #ff9800; /* Orange/Gold for money/action */
            --danger-color: #f44336;
            --success-color: #4caf50;
            --card-bg: #1e1e1e;
            --eo-color: #9c27b0; /* Purple for the mysterious EO */
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* UTILS */
        .hidden { display: none !important; }
        .btn {
            background-color: var(--card-bg);
            border: 1px solid var(--accent-color);
            color: var(--accent-color);
            padding: 10px 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
            text-transform: uppercase;
            margin: 5px;
        }
        .btn:hover {
            background-color: var(--accent-color);
            color: var(--bg-color);
        }
        .btn:disabled {
            border-color: #555;
            color: #555;
            cursor: not-allowed;
            background: transparent;
        }

        /* HEADER */
        header {
            background-color: #000;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--accent-color);
        }
        .stats {
            display: flex;
            gap: 20px;
        }
        .stat-box {
            font-size: 1.1rem;
        }
        .stat-label { color: #888; font-size: 0.8rem; }
        .money { color: var(--success-color); }

        /* MAIN CONTENT AREA */
        main {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* SCREENS */
        .screen {
            width: 100%;
            max-width: 800px;
            text-align: center;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* STORAGE SELECTION */
        .storage-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .storage-card {
            background-color: var(--card-bg);
            border: 1px solid #333;
            padding: 15px;
            border-radius: 8px;
            transition: transform 0.2s;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .storage-card:hover {
            transform: scale(1.05);
            border-color: var(--accent-color);
        }
        .risk-low { color: var(--success-color); }
        .risk-med { color: var(--accent-color); }
        .risk-high { color: var(--danger-color); }

        /* ITEM REVEAL */
        .item-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
            text-align: left;
        }
        .item-row {
            background-color: var(--card-bg);
            padding: 10px;
            border-left: 4px solid #555;
            display: flex;
            justify-content: space-between;
        }
        .rarity-junk { border-color: #777; }
        .rarity-common { border-color: var(--success-color); }
        .rarity-rare { border-color: var(--accent-color); }
        .rarity-legendary { border-color: #ffeb3b; box-shadow: 0 0 10px #ffeb3b44; }

        /* NEGOTIATION / EO SHOP */
        .shop-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .eo-area {
            background-color: #1a051a; /* Dark purple tint */
            border: 2px solid var(--eo-color);
            padding: 20px;
            border-radius: 10px;
            position: relative;
        }
        .eo-name {
            color: var(--eo-color);
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 10px;
            text-align: left;
        }
        .eo-dialogue {
            font-style: italic;
            font-size: 1.1rem;
            min-height: 60px;
        }
        .negotiation-interface {
            display: flex;
            flex-direction: row;
            gap: 20px;
            margin-top: 20px;
            text-align: left;
        }
        .current-item {
            flex: 1;
            background: var(--card-bg);
            padding: 15px;
            border: 1px solid #444;
        }
        .actions {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* LOG */
        #game-log {
            font-family: monospace;
            font-size: 0.9rem;
            color: #888;
            margin-top: 20px;
            max-height: 100px;
            overflow-y: auto;
            border-top: 1px solid #333;
            padding-top: 10px;
            text-align: left;
        }

    </style>
</head>
<body>

    <header>
        <div style="font-weight:bold; font-size:1.5rem;">DEPO SAVAŞLARI</div>
        <div class="stats">
            <div class="stat-box">
                <span class="stat-label">TUR</span><br>
                <span id="ui-round">1</span>
            </div>
            <div class="stat-box">
                <span class="stat-label">BAKİYE</span><br>
                <span id="ui-money" class="money">1000 ₺</span>
            </div>
            <div class="stat-box">
                <span class="stat-label">İTİBAR (EO)</span><br>
                <span id="ui-reputation">Nötr</span>
            </div>
        </div>
    </header>

    <main id="app">
        <!-- Screens will be injected here by JS -->
        <div id="loading" class="screen">
            <h2>Yükleniyor...</h2>
        </div>
    </main>

    <script>
        // --- CONFIG & CONSTANTS ---
        const GAME_CONFIG = {
            startMoney: 2000, // Enough for a low tier unit
            maxRounds: 999, // Infinite for now
        };

        const RARITY = {
            JUNK: { id: 'junk', label: 'Hurda', color: '#9e9e9e', mult: 0.5 },
            COMMON: { id: 'common', label: 'Sıradan', color: '#4caf50', mult: 1.0 },
            RARE: { id: 'rare', label: 'Nadir', color: '#ff9800', mult: 2.5 },
            LEGENDARY: { id: 'legendary', label: 'Efsanevi', color: '#ffeb3b', mult: 10.0 }
        };

        const ITEMS_DB = [
            // JUNK
            { name: "Eski Gazete Yığını", type: "junk", baseValue: 20 },
            { name: "Kırık Sandalye", type: "junk", baseValue: 50 },
            { name: "Paslı Bisiklet Tekerleği", type: "junk", baseValue: 30 },
            { name: "Küflü Kitaplar", type: "junk", baseValue: 40 },
            { name: "Tek Ayakkabı", type: "junk", baseValue: 10 },
            { name: "Bozuk Vantilatör", type: "junk", baseValue: 80 },

            // COMMON
            { name: "İkinci El Mikrodalga", type: "common", baseValue: 400 },
            { name: "Ahşap Sehpa", type: "common", baseValue: 300 },
            { name: "Kullanılmış Ders Kitapları", type: "common", baseValue: 250 },
            { name: "Porselen Yemek Takımı (Eksik)", type: "common", baseValue: 600 },
            { name: "Çalışan Tost Makinesi", type: "common", baseValue: 350 },
            { name: "Balık Oltası", type: "common", baseValue: 500 },
            { name: "Eski Model Ütü", type: "common", baseValue: 200 },

            // RARE
            { name: "Gümüş Çatal Bıçak Seti", type: "rare", baseValue: 2500 },
            { name: "1990 Yapımı Oyun Konsolu", type: "rare", baseValue: 3000 },
            { name: "İmzalı Futbol Forması", type: "rare", baseValue: 4000 },
            { name: "Antika Cep Saati", type: "rare", baseValue: 4500 },
            { name: "Profesyonel Kamera Lensi", type: "rare", baseValue: 3500 },
            { name: "El Dokuması Kilim", type: "rare", baseValue: 2800 },

            // LEGENDARY
            { name: "Osmanlı Dönemi Hançer", type: "legendary", baseValue: 15000 },
            { name: "Altın Kolye (18 Ayar)", type: "legendary", baseValue: 12000 },
            { name: "Kapalı Kutu Son Model Laptop", type: "legendary", baseValue: 25000 },
            { name: "Ünlü Bir Ressamın Eskizi", type: "legendary", baseValue: 30000 },
            { name: "Elmas Yüzük", type: "legendary", baseValue: 40000 }
        ];

        // --- EO INTELLIGENCE ---
        const EO_AI = {
            mood: 'neutral', // neutral, happy, annoyed, angry
            patience: 3, // Lowers with bad offers

            dialogue: {
                greeting: [
                    "Ooo, yine mi sen? Bakalım bugün ne getirdin.",
                    "Hoş geldin. Umarım vakit harcamaya değecek şeyler vardır.",
                    "Çabuk ol, başka işlerim de var."
                ],
                inspecting: [
                    "Hımm... Şuna bir bakalım.",
                    "Bunun ne olduğunu bildiğine emin misin?",
                    "İlginç... ama satılır mı emin değilim."
                ],
                lowball: [
                    "Buna en fazla bu kadar veririm. İşine gelirse.",
                    "Bak, bu piyasada bundan fazlasını bulamazsın.",
                    "Sırf senin hatırına bu fiyatı veriyorum."
                ],
                accept: [
                    "Tamamdır, anlaştık.",
                    "Güzel, ver bakalım.",
                    "Hah, sonunda mantıklı bir karar verdin."
                ],
                reject: [
                    "Dalga mı geçiyorsun? Git işine.",
                    "Bu fiyatla ancak kendini kandırırsın.",
                    "Benimle oyun oynama evlat."
                ],
                threatResponse: [
                    "Beni tehdit etme, zararlı çıkarsın.",
                    "Cesaretini takdir ettim ama aptallığını değil.",
                    "Tamam tamam, sakin ol. Belki bir şeyler yapabiliriz."
                ]
            },

            getLine: function(category) {
                const lines = this.dialogue[category];
                return lines[Math.floor(Math.random() * lines.length)];
            },

            // Logic to determine initial offer (always lowball)
            calculateOffer: function(itemRealValue, reputation) {
                // Base offer is 40-60% of real value
                let percent = 0.4 + (Math.random() * 0.2);

                // Reputation bonus (small)
                if (reputation > 70) percent += 0.1;
                if (reputation < 30) percent -= 0.1;

                return Math.floor(itemRealValue * percent);
            }
        };

        // --- STATE ---
        let gameState = {
            money: GAME_CONFIG.startMoney,
            round: 1,
            reputation: 50, // 0-100, 50 is neutral
            inventory: [],
            currentUnit: null,
            history: [],
            gameOver: false
        };

        // --- DOM ELEMENTS ---
        const ui = {
            app: document.getElementById('app'),
            money: document.getElementById('ui-money'),
            round: document.getElementById('ui-round'),
            rep: document.getElementById('ui-reputation')
        };

        // --- INIT ---
        window.onload = () => {
            initGame();
        };

        function initGame() {
            console.log("Oyun Başlatıldı.");
            updateHeader();
            startRound();
        }

        function updateHeader() {
            ui.money.innerText = gameState.money.toLocaleString('tr-TR') + ' ₺';
            ui.round.innerText = gameState.round;

            let repText = "Nötr";
            if (gameState.reputation > 70) repText = "Dost";
            else if (gameState.reputation > 85) repText = "Ortak";
            else if (gameState.reputation < 30) repText = "Şüpheli";
            else if (gameState.reputation < 15) repText = "Düşman";

            ui.rep.innerText = repText;
            ui.rep.style.color = gameState.reputation < 30 ? 'var(--danger-color)' : (gameState.reputation > 70 ? 'var(--success-color)' : 'var(--text-color)');
        }

        // --- GAME LOGIC ---

        function startRound() {
            gameState.availableUnits = generateStorageUnits();

            // Check for Game Over (Bankruptcy)
            // If the player cannot afford the cheapest unit, they are done.
            const cheapestUnit = Math.min(...gameState.availableUnits.map(u => u.price));

            if (gameState.money < cheapestUnit) {
                renderGameOver();
            } else {
                renderStorageSelection();
            }
        }

        function renderGameOver() {
            ui.app.innerHTML = `
                <div class="screen">
                    <h1 style="color: var(--danger-color)">İFLAS ETTİN</h1>
                    <p>Cebinde kalan para: ${gameState.money} ₺</p>
                    <p>EO: "Üzgünüm dostum, burası hayır kurumu değil. Başka kapıya."</p>
                    <p>Ulaşılan Tur: ${gameState.round}</p>
                    <button class="btn" onclick="location.reload()">TEKRAR DENE</button>
                </div>
            `;
        }

        function generateStorageUnits() {
            const units = [];
            const risks = ['Düşük', 'Orta', 'Yüksek'];

            for(let i=0; i<5; i++) {
                const riskLevel = Math.floor(Math.random() * 3); // 0, 1, 2

                // Price calcs based on risk and some randomness
                // Base price scales slowly with rounds to keep it playable
                let basePrice = 500 + (gameState.round * 50);

                let priceMultiplier = 1;
                if(riskLevel === 1) priceMultiplier = 1.5;
                if(riskLevel === 2) priceMultiplier = 2.5;

                const price = Math.floor(basePrice * priceMultiplier * (0.8 + Math.random() * 0.4));

                units.push({
                    id: i,
                    name: `Depo #${100 + i + (gameState.round * 5)}`,
                    risk: riskLevel, // 0=Low, 1=Med, 2=High
                    riskLabel: risks[riskLevel],
                    price: price,
                    description: generateUnitDescription(riskLevel)
                });
            }
            return units;
        }

        function generateUnitDescription(risk) {
            const descs = [
                ["Temiz görünüyor.", "Birkaç koli var.", "Standart ev eşyaları."], // Low
                ["Karışık bir yığın.", "Bazı kutular kapalı.", "Tozlu ama dolu."], // Med
                ["Tam bir muamma.", "Ya hazine ya çöp.", "Ağır kutular var."] // High
            ];
            return descs[risk][Math.floor(Math.random() * descs[risk].length)];
        }

        function renderStorageSelection() {
            const containerHtml = gameState.availableUnits.map(unit => {
                const riskClass = unit.risk === 0 ? 'risk-low' : (unit.risk === 1 ? 'risk-med' : 'risk-high');
                const canAfford = gameState.money >= unit.price;

                return `
                <div class="storage-card" onclick="${canAfford ? `buyUnit(${unit.id})` : ''}" style="${!canAfford ? 'opacity:0.5; cursor:not-allowed' : ''}">
                    <h3>${unit.name}</h3>
                    <p>${unit.description}</p>
                    <p>Risk: <span class="${riskClass}">${unit.riskLabel}</span></p>
                    <div style="margin-top:auto; font-size:1.2rem; font-weight:bold; color:var(--accent-color)">
                        ${unit.price} ₺
                    </div>
                </div>
                `;
            }).join('');

            ui.app.innerHTML = `
                <div class="screen">
                    <h2>GÜNÜN İHALESİ: BİR DEPO SEÇ</h2>
                    <p>Paran: <span class="money">${gameState.money} ₺</span></p>
                    <div class="storage-grid">
                        ${containerHtml}
                    </div>
                </div>
            `;
        }

        // --- SHOP & NEGOTIATION ---

        let negotiationState = null;

        window.startShopPhase = function() {
            renderShop();
        };

        function renderShop() {
            // Check if all items sold
            if (gameState.inventory.length === 0) {
                finishRound();
                return;
            }

            // Filter items that are not being negotiated currently
            // (If we were supporting parallel negos, but here we do one by one or list)

            // If we are in a negotiation, show that screen
            if (negotiationState) {
                renderNegotiation();
                return;
            }

            // Otherwise show list to pick
            const listHtml = gameState.inventory.map(item => {
                let rarityInfo = Object.values(RARITY).find(r => r.id === item.type);
                return `
                <div class="item-row rarity-${item.type}" style="cursor:pointer" onclick="initNegotiation(${item.id})">
                    <div>
                        <strong>${item.name}</strong><br>
                        <span style="color:${rarityInfo.color}; font-size:0.8rem">${rarityInfo.label}</span>
                    </div>
                    <button class="btn" style="font-size:0.8rem">SAT</button>
                </div>
                `;
            }).join('');

            ui.app.innerHTML = `
                <div class="screen">
                    <h2>EO'NUN DÜKKANI</h2>
                    <div class="eo-area">
                        <div class="eo-name">EO</div>
                        <div class="eo-dialogue">"${EO_AI.getLine('greeting')}"</div>
                    </div>
                    <p>Satmak istediğin eşyayı seç:</p>
                    <div class="item-list">
                        ${listHtml}
                    </div>
                </div>
            `;
        }

        window.initNegotiation = function(itemId) {
            const item = gameState.inventory.find(i => i.id === itemId);
            const initialOffer = EO_AI.calculateOffer(item.realValue, gameState.reputation);

            negotiationState = {
                item: item,
                currentOffer: initialOffer,
                eoPatience: EO_AI.patience,
                status: 'active', // active, sold, failed
                lastMove: 'start',
                dialogue: "Ooo, bunu mu satıyorsun? Bakalım kaç para eder..."
            };

            renderNegotiation();
        };

        function renderNegotiation() {
            const state = negotiationState;
            const item = state.item;
            const rarityInfo = Object.values(RARITY).find(r => r.id === item.type);

            ui.app.innerHTML = `
                <div class="screen">
                    <h2>PAZARLIK</h2>

                    <div class="eo-area">
                        <div class="eo-name">EO (Sabır: ${"♦".repeat(state.eoPatience)})</div>
                        <div class="eo-dialogue">"${state.dialogue}"</div>
                        <div style="margin-top:10px; font-size:1.4rem; color:var(--success-color)">
                            TEKLİF: ${state.currentOffer} ₺
                        </div>
                    </div>

                    <div class="negotiation-interface">
                        <div class="current-item">
                            <h3>${item.name}</h3>
                            <span style="color:${rarityInfo.color}">${rarityInfo.label}</span>
                            <hr>
                            <p style="font-size:0.8rem; color:#888;">Gerçek Değeri (Senin Bilgin): ???</p>
                            <!-- Hint about value based on rarity could go here -->
                        </div>
                        <div class="actions">
                            <button class="btn" onclick="actionAccept()">KABUL ET (${state.currentOffer} ₺)</button>
                            <button class="btn" onclick="showCounterInput()">PAZARLIK YAP</button>
                            <button class="btn" style="border-color: #9c27b0; color: #9c27b0" onclick="actionBluff()">BLÖF YAP ("Bu çok nadir!")</button>
                            <button class="btn" style="border-color: var(--danger-color); color: var(--danger-color)" onclick="actionThreaten()">TEHDİT ET</button>
                            <button class="btn" style="margin-top:20px; border-color:#555; color:#888;" onclick="actionCancel()">VAZGEÇ</button>
                        </div>
                    </div>
                </div>
            `;
        }

        window.actionAccept = function() {
            // Sell item
            gameState.money += negotiationState.currentOffer;

            // Log logic could be here

            // Remove item
            gameState.inventory = gameState.inventory.filter(i => i.id !== negotiationState.item.id);

            // Reputation small boost for easy deal
            changeReputation(1);

            negotiationState = null;
            updateHeader();
            renderShop();
        };

        window.actionCancel = function() {
            negotiationState = null;
            renderShop();
        };

        window.showCounterInput = function() {
            const currentOffer = negotiationState.currentOffer;
            const promptAmount = prompt("Karşı teklifin nedir? (Sadece sayı)", currentOffer);
            if (promptAmount) {
                const val = parseInt(promptAmount);
                if (!isNaN(val)) {
                    processCounterOffer(val);
                }
            }
        };

        function processCounterOffer(playerOffer) {
            const state = negotiationState;
            const item = state.item;
            const realValue = item.realValue;

            // Logic: Is the offer reasonable?
            // Reasonable range: up to 120% of real value if reputation is high
            // Hard limit: 150% of real value

            let maxTolerable = realValue * (1.0 + (gameState.reputation / 200));

            // Hidden Interest Mechanic
            if (item.eoInterest === 2) {
                // He really wants it, so he will tolerate higher prices eventually
                maxTolerable *= 1.5;
            } else if (item.eoInterest === 1) {
                maxTolerable *= 1.2;
            }

            if (playerOffer <= state.currentOffer) {
                state.dialogue = "Daha düşük teklif mi? Kafan mı güzel? Neyse, kabul.";
                state.currentOffer = playerOffer;
                renderNegotiation();
                return;
            }

            if (playerOffer <= maxTolerable) {
                // Success chance based on how greedy the player is
                const greedFactor = playerOffer / realValue; // 1.0 = fair, 1.2 = pushing it
                const roll = Math.random();

                if (roll > (greedFactor - 0.5)) {
                    // Accepted
                    state.currentOffer = playerOffer;

                    if (item.eoInterest === 2) {
                         state.dialogue = "Tamam tamam, alıyorum. Sakın kimseye bu fiyattan bahsetme.";
                    } else {
                         state.dialogue = EO_AI.getLine('accept');
                    }
                } else {
                    // Counter-counter
                    const middleGround = Math.floor((state.currentOffer + playerOffer) / 2);
                    state.currentOffer = middleGround;
                    state.dialogue = "Çok istiyorsun. Şurada buluşalım.";
                    state.eoPatience -= 1;
                }
            } else {
                // Insultingly high
                state.dialogue = EO_AI.getLine('reject');
                state.eoPatience -= 1;
            }

            checkPatience();
            renderNegotiation();
        }

        window.actionBluff = function() {
            const state = negotiationState;
            // Bluff mechanics: Try to increase perceived value
            const roll = Math.random();
            const successChance = 0.4 + (gameState.reputation / 200);

            if (roll < successChance) {
                // Success
                state.currentOffer = Math.floor(state.currentOffer * 1.5);
                state.dialogue = "Hmm... Gerçekten mi? Bak bunu fark etmemiştim. Fiyatı arttırıyorum.";
            } else {
                // Fail
                state.dialogue = "Kimi kandırıyorsun sen? Bu numara bana sökmez.";
                state.eoPatience -= 2;
                changeReputation(-5);
            }
            checkPatience();
            renderNegotiation();
        };

        window.actionThreaten = function() {
            const state = negotiationState;
            // High risk
            const roll = Math.random();
            if (roll > 0.7) {
                // Success: Force max value
                state.currentOffer = Math.floor(state.item.realValue * 1.2);
                state.dialogue = EO_AI.getLine('threatResponse');
                changeReputation(-10); // Reputation hit even if successful
            } else {
                // Fail: EO ends negotiation
                state.dialogue = "Defol dükkanımdan!";
                state.eoPatience = 0;
            }
            checkPatience();
            renderNegotiation();
        };

        function checkPatience() {
            if (negotiationState.eoPatience <= 0) {
                // Force sell at low price or kick out?
                // For now, let's say he forces the last offer or kicks out.
                // Let's make him withdraw the offer and offer a pity amount (scrap value).
                negotiationState.dialogue = "Sabrımı taşırdın. Ya bu fiyata alırsın ya da defolursun.";
                negotiationState.currentOffer = Math.floor(negotiationState.item.baseValue * 0.1); // 10% scrap value
                // Lock buttons maybe? For simplicity, we just set the offer low and let player accept/leave.
            }
        }

        // --- HELPERS ---
        function changeReputation(amount) {
            gameState.reputation = Math.min(100, Math.max(0, gameState.reputation + amount));
        }

        function finishRound() {
            gameState.round++;
            gameState.availableUnits = [];
            ui.app.innerHTML = `
                <div class="screen">
                    <h2>TUR TAMAMLANDI</h2>
                    <p>Bugünkü hasılatı topladın.</p>
                    <p class="money" style="font-size:2rem">${gameState.money} ₺</p>
                    <button class="btn" onclick="startRound()">SONRAKİ TUR</button>
                </div>
            `;
            updateHeader();
        }

        window.buyUnit = function(id) {
            const unit = gameState.availableUnits.find(u => u.id === id);
            if(gameState.money < unit.price) return;

            gameState.money -= unit.price;
            gameState.currentUnit = unit;
            updateHeader();

            // Generate items
            gameState.inventory = generateItemsForUnit(unit);

            revealItems();
        };

        function generateItemsForUnit(unit) {
            const itemCount = 3 + Math.floor(Math.random() * 3); // 3-5 items
            const items = [];

            for(let i=0; i<itemCount; i++) {
                // Determine rarity based on risk
                let roll = Math.random();
                let chosenType = 'junk';

                if (unit.risk === 0) { // Low Risk: Mostly Common, some Junk
                    if (roll > 0.3) chosenType = 'common';
                    if (roll > 0.9) chosenType = 'rare';
                } else if (unit.risk === 1) { // Med Risk: Balanced
                    if (roll > 0.2) chosenType = 'common';
                    if (roll > 0.7) chosenType = 'rare';
                    if (roll > 0.95) chosenType = 'legendary';
                } else { // High Risk: High Junk OR High Legendary
                    if (roll > 0.5) chosenType = 'junk';
                    else if (roll > 0.8) chosenType = 'rare';
                    else if (roll > 0.9) chosenType = 'legendary';
                    else chosenType = 'common';
                }

                const possibleItems = ITEMS_DB.filter(x => x.type === chosenType);
                const template = possibleItems[Math.floor(Math.random() * possibleItems.length)];

                // Variation in value
                const valueVariation = 0.8 + (Math.random() * 0.4); // +/- 20%
                const finalValue = Math.floor(template.baseValue * valueVariation);

                items.push({
                    ...template,
                    realValue: finalValue,
                    eoInterest: Math.random() > 0.8 ? 2 : (Math.random() > 0.5 ? 1 : 0), // 0=None, 1=Mild, 2=High
                    id: Date.now() + i
                });
            }
            return items;
        }

        function revealItems() {
            const listHtml = gameState.inventory.map(item => {
                let rarityInfo = Object.values(RARITY).find(r => r.id === item.type);
                return `
                <div class="item-row rarity-${item.type}">
                    <div>
                        <strong>${item.name}</strong><br>
                        <span style="color:${rarityInfo.color}; font-size:0.8rem">${rarityInfo.label}</span>
                    </div>
                    <div style="display:flex; align-items:center;">
                        <span style="color:#888; font-size:0.9rem">Tahmini: ???</span>
                    </div>
                </div>
                `;
            }).join('');

            ui.app.innerHTML = `
                <div class="screen">
                    <h2>DEPODAN ÇIKANLAR</h2>
                    <div class="item-list">
                        ${listHtml}
                    </div>
                    <button class="btn" onclick="startShopPhase()">EO'NUN DÜKKANINA GİT</button>
                </div>
            `;
        }

    </script>
</body>
</html>
